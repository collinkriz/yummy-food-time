<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yummy Food Time</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; background-color: #f9fafb; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const App = () => {
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setLoading(true);
                const reader = new FileReader();
                
                reader.onloadend = async () => {
                    const base64Image = reader.result.split(',')[1];
                    
                    try {
                        const response = await fetch('/api/anthropic', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                model: "claude-3-5-sonnet-20240620",
                                max_tokens: 1024,
                                messages: [{
                                    role: "user",
                                    content: [
                                        { type: "text", text: "Extract the items and total from this receipt and return it as a simple list." },
                                        { type: "image", source: { type: "base64", media_type: "image/jpeg", data: base64Image } }
                                    ]
                                }]
                            })
                        });

                        const data = await response.json();
                        if (data.content && data.content[0]) {
                            setResult(data.content[0].text);
                        } else {
                            throw new Error("No data returned from AI");
                        }
                    } catch (err) {
                        console.error("Extraction Failed:", err);
                        alert("Cloud Extraction Failed. Check Vercel logs for details.");
                    } finally {
                        setLoading(false);
                    }
                };
                reader.readAsDataURL(file);
            };

            return (
                <div className="max-w-md mx-auto mt-10 p-6 bg-white rounded-xl shadow-md text-center">
                    <h1 className="text-2xl font-bold mb-4">Yummy Food Time ðŸ¥˜</h1>
                    <p className="text-gray-600 mb-6">Upload a receipt to extract items.</p>
                    
                    <label className="block">
                        <span className="sr-only">Choose receipt photo</span>
                        <input 
                            type="file" 
                            accept="image/*" 
                            onChange={handleFileUpload} 
                            disabled={loading}
                            className="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100 cursor-pointer"
                        />
                    </label>

                    {loading && (
                        <div className="mt-6 text-orange-600 font-medium animate-pulse">
                            Processing receipt with AI...
                        </div>
                    )}

                    {result && (
                        <div className="mt-8 p-4 bg-gray-50 rounded-lg text-left border border-gray-200">
                            <h2 className="font-bold mb-2">Results:</h2>
                            <pre className="whitespace-pre-wrap text-sm text-gray-700">{result}</pre>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
